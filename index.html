
<!DOCTYPE html>
<html>
<head>
  <title>Persistent Terminal</title>
  <style>
    body { background: #000; color: #0f0; font-family: monospace; padding: 10px; }
    #terminal { white-space: pre-wrap; }
    input { background: #000; color: #0f0; border: none; width: 100%; font-size: 1em; }
  </style>
</head>
<body>
  <div id="terminal"></div>
  <input type="text" id="input" autofocus placeholder="Type command and press Enter">

  <script>
    const term = document.getElementById('terminal');
    const input = document.getElementById('input');

    async function loadHistory() {
      const res = await fetch('/history');
      const history = await res.json();
      history.reverse().forEach(item => {
        term.innerText += '$ ' + item.command_text + '\n' + item.output_text + '\n';
      });
    }

    async function sendCommand(cmd) {
      const res = await fetch('/run', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ command: cmd })
      });
      const data = await res.json();
      term.innerText += '$ ' + cmd + '\n' + data.output + '\n';
      term.scrollTop = term.scrollHeight;
    }

    input.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        const cmd = input.value;
        input.value = '';
        sendCommand(cmd);
      }
    });

    loadHistory();
  </script>
</body>
</html>
